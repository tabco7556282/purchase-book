<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>診断パネル v1</title>
<style>
  body{font-family:system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; margin:0; background:#f6f7f9; color:#111}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e5e7eb;padding:12px}
  main{max-width:800px;margin:0 auto;padding:16px}
  h1{margin:0;font-size:18px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin:12px 0}
  .btn{padding:12px 16px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;margin:6px 6px 0 0;display:inline-block}
  #log{white-space:pre-wrap;font:12px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;background:#0b1020;color:#e6edf3;border-radius:10px;padding:12px;min-height:140px;overflow:auto}
  a.btn{color:#0b3ea8;text-decoration:none}
</style>
</head>
<body>
<header><h1>診断パネル v1</h1></header>
<main>
  <div class="card">
    <div style="margin-bottom:8px">下のボタンを順に押してください（反応があればJSは生きています）</div>
    <button class="btn" onclick="testAlert()">① アラート表示</button>
    <button class="btn" onclick="testStorage()">② localStorage 書込/読込</button>
    <button class="btn" onclick="testSW()">③ Service Worker 一覧</button>
    <a class="btn" href="tel:0123456789">④ 電話リンク動作</a>
    <button class="btn" onclick="forceReload()">⑤ このページを強制再読み込み</button>
  </div>

  <div class="card"><strong>ログ</strong><div id="log"></div></div>

  <div class="card">
    <strong>ページ情報</strong>
    <div id="info"></div>
  </div>
</main>

<script>
const $ = (id)=>document.getElementById(id);
function log(...args){ $('log').textContent += args.join(' ') + "\n"; }
window.onerror = function(msg, src, line, col, err){
  log('⚠️ JSエラー:', msg, '@', src, line+':'+col, err && err.stack ? '\n'+err.stack : '');
};

function testAlert(){
  alert('アラート表示OK');
  log('✅ アラートOK（JS実行中）');
}
function testStorage(){
  try{
    const key = 'diag_' + Date.now();
    localStorage.setItem(key, 'ok');
    const v = localStorage.getItem(key);
    log('✅ localStorage 書込/読込:', v === 'ok' ? 'OK' : 'NG');
  }catch(e){ log('❌ localStorage エラー:', e.message); }
}
async function testSW(){
  try{
    if(!('serviceWorker' in navigator)){ log('ℹ️ serviceWorker: 未対応'); return; }
    const regs = await navigator.serviceWorker.getRegistrations();
    if(!regs.length){ log('ℹ️ 登録なし'); return; }
    log('⚠️ 登録済みSW数:', regs.length);
    for(const r of regs){ log(' - scope:', r.scope); }
  }catch(e){ log('❌ SW一覧取得エラー:', e.message); }
}
function forceReload(){
  const u = new URL(location.href);
  u.searchParams.set('t', Date.now());
  location.replace(u.toString());
}

document.addEventListener('DOMContentLoaded', ()=>{
  const u = new URL(location.href);
  $('info').textContent = [
    'URL: ' + location.href,
    'UA: ' + navigator.userAgent,
    'Time: ' + new Date().toISOString()
  ].join('\n');
  log('ℹ️ DOMContentLoaded 到達');
});
</script>
</body>
</html>
